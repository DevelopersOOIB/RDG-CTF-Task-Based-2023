from Cryptodome.Util.number import long_to_bytes

p = 113641842374773044745452662471378715712124744803786300890087741266845552497445274911054126455206043851172654951999459532631143246187756241338954515000426316814056710573904671705426280457773213203770699075812543476488669211671733660131140193807192700380376595760637713843721593216448687060984159575308383246829
g = 4971905734578114578103012188534162412154217839402427699027620871253633102571835127029750314112156046747872303795577123499710901658849488125954816314744943661146055519239143913435154769457062318617874881558261094899454408071345335844420144450891226007191374704820474341171395312812199095985963800532766775553
ka = 112908899095628474171781619483833207319419645190609184826394926794300909502577948595139235027841438684049437800616829639858373087220413207341988643462084888607126144492968003654948509351197078555423151809979695694811419641179026651315369795002629711347917101960284354629889287447613899770176335238880061054757
kb = 105420275150962955177454632305560137805906956216759122649225252368200175440917573625144023018386746968022110633750396807562169639563420633204909529606603630940601182362674744707925344234590044240139579494956906751254050990323774536120695587931533828151120207366863369544770981650253077464334229857753084008014

r = b"PNG"

with open('text.png.enc', 'rb') as file:
    cipher = file.read()

j = 1
while True:
    k = long_to_bytes(pow(g, j, p))
    r1 = bytes([cipher[i] ^ k[i % len(k)] for i in range(4)])
    if r1[1:4] == r:
        break
    j += 1

text = bytes([cipher[i] ^ k[i % len(k)] for i in range(len(cipher))])

with open('text.png', 'wb') as file:
    file.write(text)
